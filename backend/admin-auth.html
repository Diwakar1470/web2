<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Authentication & Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }</style>
</head>
<body class="min-h-screen flex flex-col">
    <script src="../scripts/auth-config.js"></script>
    <nav class="bg-white shadow-md py-4 px-6 flex justify-between">
        <span class="font-bold text-xl text-indigo-600">Creator Panel</span>
        <a href="../index.html" class="text-gray-600 hover:text-indigo-600">Back to Home</a>
    </nav>
    <div class="flex-grow container mx-auto p-6">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">Manage Access</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Add HOD -->
                <div class="border p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-4">Add HOD</h3>
                    <form onsubmit="event.preventDefault(); addAuth('hods', this);">
                        <input type="email" name="email" placeholder="Email" class="w-full mb-2 p-2 border rounded" required>
                        <input type="text" name="id" placeholder="ID/Password" class="w-full mb-2 p-2 border rounded" required>
                        <input type="text" name="department" placeholder="Department (e.g. CSE)" class="w-full mb-2 p-2 border rounded" required>
                        <button class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">Add HOD</button>
                    </form>
                </div>
                <!-- Add Coordinator -->
                <div class="border p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-4">Add Coordinator</h3>
                    <form onsubmit="event.preventDefault(); addAuth('coordinators', this);">
                        <input type="email" name="email" placeholder="Email" class="w-full mb-2 p-2 border rounded" required>
                        <input type="text" name="id" placeholder="ID/Password" class="w-full mb-2 p-2 border rounded" required>
                        <select name="role" class="w-full mb-2 p-2 border rounded">
                            <option value="Faculty Coordinator">Faculty Coordinator</option>
                            <option value="Student Coordinator">Student Coordinator</option>
                        </select>
                        <input type="text" name="activity" placeholder="Activity (e.g. NCC)" class="w-full mb-2 p-2 border rounded" required>
                        <button class="w-full bg-teal-600 text-white py-2 rounded hover:bg-teal-700">Add Coordinator</button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Current Overrides List -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-bold text-lg mb-4">Current Local Overrides</h3>
            <pre id="overridesDisplay" class="bg-gray-100 p-4 rounded text-sm overflow-auto"></pre>
            <button onclick="clearOverrides()" class="mt-4 text-red-600 text-sm hover:underline">Clear All Overrides</button>
        </div>
    </div>

    <script>
        function loadOverrides() {
            const raw = localStorage.getItem('AUTH_ALLOWED_OVERRIDES');
            const data = raw ? JSON.parse(raw) : { coordinators: [], hods: [] };
            document.getElementById('overridesDisplay').textContent = JSON.stringify(data, null, 2);
            return data;
        }

        function addAuth(type, form) {
            const data = loadOverrides();
            if (!data[type]) data[type] = [];
            
            const newItem = {
                email: form.email.value,
                id: form.id.value
            };
            if (form.department) newItem.department = form.department.value;
            if (form.role) newItem.role = form.role.value;
            if (form.activity) newItem.activity = form.activity.value;

            data[type].push(newItem);
            localStorage.setItem('AUTH_ALLOWED_OVERRIDES', JSON.stringify(data));
            loadOverrides();
            form.reset();
            alert('Added successfully! Refresh login pages to see changes.');
        }

        function clearOverrides() {
            if(confirm('Clear all local overrides?')) {
                localStorage.removeItem('AUTH_ALLOWED_OVERRIDES');
                loadOverrides();
            }
        }

        loadOverrides();
    </script>
</body>
</html>